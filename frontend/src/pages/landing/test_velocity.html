<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Velocity Test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-velocity@1.9.0/dist/leaflet-velocity.min.js"></script>
    <style>
        #map { height: 100vh; width: 100%; }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        const map = L.map('map').setView([0, -150], 3);
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Esri'
        }).addTo(map);

        // Load velocity data
        fetch('./ocean_velocity.json')
            .then(response => response.json())
            .then(response => {
                // Unwrap data if needed
                const data = response.data ? response.data : response;
                console.log("raw data:", response);
                console.log('Loaded velocity data:', data);
                console.log('U header:', data[0].header);
                console.log('V header:', data[1].header);
                console.log('First 100 U values:', data[0].data.slice(0, 100));
                console.log('First valid U value:', data[0].data.find(v => v !== null && v !== "NaN"));
                const velocityLayer = L.velocityLayer({
                    displayValues: true,
                    displayOptions: {
                        velocityType: 'Ocean Current',
                        position: 'bottomleft',
                        emptyString: 'No data',
                        speedUnit: 'm/s'
                    },
                    data: data,
                    maxVelocity: 1.5,
                    velocityScale: 0.05,
                    particleAge: 30,
                    lineWidth: 2,
                    particleMultiplier: 1/20
                });

                velocityLayer.addTo(map);
                console.log('Added velocity layer');
                console.log('Zoom to Pacific, Gulf Stream, or Southern Ocean to see currents');
            })
            .catch(err => console.error('Error:', err));
    </script>
</body>
</html>
